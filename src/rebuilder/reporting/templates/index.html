{% extends "base.html" %}

{% block title %}OpenWrt Reproducible Build Results{% endblock %}

{% block header %}
<div class="header">
    <h1>OpenWrt Reproducible Build Results</h1>
    <p>Compare reproducibility across releases and targets</p>
    {% if build_info %}
    <div class="build-info">
        <strong>Build Time:</strong> {{ build_info.time }} |
        <strong>Commit:</strong> {{ build_info.commit }} |
        <strong>Branch:</strong> {{ build_info.branch }} |
        <strong>Run:</strong> {{ build_info.run_id }}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="card-grid">
    {% for version, version_data in releases.items() %}
    {% set stats = version_data.stats %}
    {% set total = stats.reproducible + stats.unreproducible + stats.notfound + stats.pending %}
    {% set percent = (stats.reproducible / total * 100) if total > 0 else 0 %}
    <div class="card">
        <div class="card-title">
            <a href="{{ version | replace('.', '_') }}.html">OpenWrt {{ version }}</a>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ percent | round(1) }}%"></div>
        </div>
        <div style="text-align: center; font-size: 1.3em; font-weight: bold; margin: 15px 0;">
            {{ percent | round(1) }}% Reproducible
        </div>
        <div class="stats-grid">
            <div class="stat-box reproducible">
                <div class="stat-value">{{ stats.reproducible }}</div>
                <div class="stat-label">Reproducible</div>
            </div>
            <div class="stat-box unreproducible">
                <div class="stat-value">{{ stats.unreproducible }}</div>
                <div class="stat-label">Unreproducible</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 15px; color: #666;">
            {{ version_data.target_count }} target{{ 's' if version_data.target_count != 1 else '' }} tested
        </div>
    </div>
    {% endfor %}
</div>

{% if overall_stats %}
{% set total = overall_stats.reproducible + overall_stats.unreproducible + overall_stats.notfound + overall_stats.pending %}
{% set percent = (overall_stats.reproducible / total * 100) if total > 0 else 0 %}
<div class="summary-box" style="text-align: center;">
    <h2>Overall Summary Across All Releases</h2>
    <div style="font-size: 1.5em; font-weight: bold; margin: 20px 0;">
        {{ percent | round(1) }}% Reproducible
    </div>
    <div style="font-size: 1.1em; margin: 10px 0;">
        {{ overall_stats.reproducible }} of {{ total }} items are reproducible
    </div>
    <div class="stats-grid" style="max-width: 600px; margin: 20px auto 0;">
        <div class="stat-box reproducible">
            <div class="stat-value">{{ overall_stats.reproducible }}</div>
            <div class="stat-label">Reproducible</div>
        </div>
        <div class="stat-box unreproducible">
            <div class="stat-value">{{ overall_stats.unreproducible }}</div>
            <div class="stat-label">Unreproducible</div>
        </div>
        <div class="stat-box notfound">
            <div class="stat-value">{{ overall_stats.notfound }}</div>
            <div class="stat-label">Not Found</div>
        </div>
        <div class="stat-box pending">
            <div class="stat-value">{{ overall_stats.pending }}</div>
            <div class="stat-label">Pending</div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
