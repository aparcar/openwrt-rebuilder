{% extends "base.html" %}

{% block title %}{{ version }} - OpenWrt Reproducible Build Results{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb">
    <a href="index.html">&larr; All Releases</a>
</div>
{% endblock %}

{% block header %}
<div class="header">
    <h1>OpenWrt {{ version }}</h1>
    <p>Reproducible Build Results</p>
</div>
{% endblock %}

{% block content %}
<div class="card-grid">
    {% for target, target_data in targets.items() %}
    {% set stats = target_data.stats %}
    {% set total = stats.reproducible + stats.unreproducible + stats.notfound + stats.pending %}
    {% set percent = (stats.reproducible / total * 100) if total > 0 else 0 %}
    {% set target_slug = target | replace('/', '_') %}
    <div class="card">
        <div class="card-title">
            <a href="{{ release_dir }}/{{ target_slug }}.html">{{ target }}</a>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ percent | round(1) }}%"></div>
        </div>
        <div style="text-align: center; font-size: 1.2em; font-weight: bold; margin: 12px 0;">
            {{ percent | round(1) }}% Reproducible
        </div>
        <div class="stats-grid">
            <div class="stat-box reproducible">
                <div class="stat-value">{{ stats.reproducible }}</div>
                <div class="stat-label">Reproducible</div>
            </div>
            <div class="stat-box unreproducible">
                <div class="stat-value">{{ stats.unreproducible }}</div>
                <div class="stat-label">Unreproducible</div>
            </div>
            <div class="stat-box notfound">
                <div class="stat-value">{{ stats.notfound }}</div>
                <div class="stat-label">Not Found</div>
            </div>
            <div class="stat-box pending">
                <div class="stat-value">{{ stats.pending }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if version_stats %}
{% set total = version_stats.reproducible + version_stats.unreproducible + version_stats.notfound + version_stats.pending %}
{% set percent = (version_stats.reproducible / total * 100) if total > 0 else 0 %}
<div class="summary-box" style="text-align: center;">
    <h2>{{ version }} Overall Summary</h2>
    <div style="font-size: 1.4em; font-weight: bold; margin: 15px 0;">
        {{ percent | round(1) }}% Reproducible ({{ version_stats.reproducible }} of {{ total }} items)
    </div>
    <div class="stats-grid" style="max-width: 600px; margin: 0 auto;">
        <div class="stat-box reproducible">
            <div class="stat-value">{{ version_stats.reproducible }}</div>
            <div class="stat-label">Reproducible</div>
        </div>
        <div class="stat-box unreproducible">
            <div class="stat-value">{{ version_stats.unreproducible }}</div>
            <div class="stat-label">Unreproducible</div>
        </div>
        <div class="stat-box notfound">
            <div class="stat-value">{{ version_stats.notfound }}</div>
            <div class="stat-label">Not Found</div>
        </div>
        <div class="stat-box pending">
            <div class="stat-value">{{ version_stats.pending }}</div>
            <div class="stat-label">Pending</div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
